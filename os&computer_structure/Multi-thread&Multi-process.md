### 질문. **멀티 프로세스 대신 멀티 스레드를 사용하는 이유는 무엇입니까?**

---

**질문 답변**

프로그램을 여러 개 키는 것보다 하나의 프로그램 안에서 여러 작업을 해결하는 것이 더 낫기 때문이다. 그러므로 자원의 효율성 증대, 처리 비용 감소 및 응답 시간 단축의 장점이 발생한다.

---

### 멀티 프로세스란?

- 여러 개의 프로세스가 서로 협력적으로 일을 처리하는 것.
- 여러 개의 프로세스가 작업을 병렬처리 하는 것
- 각 프로세스 간 메모리 구분이 필요하거나 독립된 주소 공간을 가져야 할 때 사용.
<img src=img/multi_process.png></img>
### 멀티 프로세스의 장점

- 독립된 구조이기 때문에 안정성이 높다.
- 여러 프로세스가 같이 작업하고 있기 때문에 하나의 프로세스가 죽는다 해도 문제가 확산되지 않는다. (대신 느려질 수는 있다. 다른 프로세스의 일을 자기가 더 해야하기 때문)
- 여러 개의 프로세스가 처리되어야 할 때 동일한 데이터를 사용하고, 이러한 데이터를 하나의 디스크에 두고 모든 프로세서(CPU)가 이를 공유하면 비용적으로 저렴해짐

### 멀티 프로세싱의 단점

- 멀티 스레드보다 많은 메모리 공간과 CPU시간을 차지한다.
- Context Switching 과정에서 캐쉬 메모리 초기화 등 무거운 작업이 진행되고 많은 시간이 소모되는 등의 오버헤드가 발생하게 된다.
- 프로세스는 각각의 독립된 메모리 영역을 할당받았기 때문에 프로세스 사이에서 공유하는 메모리가 없어, Context Switching가 발생하면 캐쉬에 있는 모든 데이터를 모두 리셋하고 다시 캐쉬 정보를 불러와야 한다.
- 프로세스 사이의 어렵고 복잡한 통신 기법(IPC)으로 프로세스는 각각의 독립된 메모리 영역을 할당받았기 때문에 하나의 프로그램에 속하는 프로세스들 사이의 변수를 공유할 수 없다.
- 컨텍스트 스위칭(Context Switching)
    
    멀티프로세스 환경에서 CPU가 어떤 하나의 프로세스를 실행하고 있는 상태에서 인터럽트 요청에 의해 다음 우선 순위의 프로세스가 실행되어야 할 때 기존의 프로세스의 상태 또는 레지스터 값(Context)을 저장하고 CPU가 다음 프로세스를 수행하도록 새로운 프로세스의 상태 또는 레지스터 값(Context)을 교체하는 작업을 말합니다.
    
    ※ 컨텍스트? CPU가 해당 프로세스를 실행하기 위한 해당 프로세스의 정보들.
    
- IPC
    
    IPC는 Inter-Process Communication의 약자로, 프로세스간 통신을 가능하게 하는 기술이다.
    
    여러 개의 프로세스가 동시에 실행되는 멀티태스킹 환경에서는 각각의 프로세스가 자신의 메모리 공간을 가지고 있기 때문에 서로 데이터를 주고받는 것이 어렵다. 이때 IPC 기술을 이용하여 프로세스 간 데이터를 주고받을 수 있다.
    
    IPC는 크게 두 가지로 나뉜다. 첫째, 프로세스가 서로 다른 머신에서 실행되는 경우에는 Network IPC를 사용하여 통신할 수 있다. 둘째, 같은 머신에서 실행되는 프로세스들은 Local IPC를 사용하여 통신할 수 있다.
    

### 멀티 스레딩이란?

하나의 응용프로그램을 여러 개의 스레드로 구성하고 각 스레드로 하여금 하나의 작업을 처리하도록 하는 것이다. 윈도우, 리눅스 등 많은 운영체제들이 멀티 프로세싱을 지원하고 있지만 멀티 스레딩을 기본으로 하고 있다. 

ex) 웹 서버는 대표적인 멀티 스레드 응용 프로그램
<img src=img/multi_thread.png></img>

### 멀티 스레딩의 장점

- 시스템 자원 소모 감소 (자원의 효율성 증대)프로세스를 생성하여 자원을 할당하는 시스템 콜이 줄어들어 자원을 효율적으로 관리할 수 있다.
- 시스템 처리량 증가 (처리 비용 감소)스레드 간 데이터를 주고 받는 것이 간단해지고 시스템 자원 소모가 줄어들게 된다.
- 스레드 사이의 작업량이 작아 Context Switching이 빠르다.
- 간단한 통신 방법으로 인한 프로그램 응답 시간 단축
- 스레드는 프로세스 내의 Stack 영역을 제외한 모든 메모리를 공유하기 때문에 통신의 부담이 적다.
- 힙 영역을 공유하므로 데이터를 주고받을 수 있다.

### 멀티 스레딩의 단점

- 주의깊은 설계가 필요하고 디버깅이 어렵다. (불필요 부분까지 동기화하면, 대기시간으로 인해 성능 저하 발생)
- 단일 프로세스 시스템의 경우 효과를 기대하기 어렵다.
- 다른 프로세스에서 스레드를 제어할 수 없다. (즉, 프로세스 밖에서 스레드 각각을 제어할 수 없다.)
- 자원을 공유하기에 동기화 문제가 발생할 수 있음 (병목현상, 데드락 등)
- 하나의 스레드에 문제가 발생하면 전체 프로세스가 영향을 받는다.

### **멀티 스레드 vs 멀티 프로세스**

- **멀티 스레드**는 멀티 프로세스보다 **적은 메모리 공간을 차지**하고 `Context Switching`이 빠른 장점이 있지만, 동기화 문제와 하나의 스레드 장애로 **전체 스레드가 종료 될 위험**을 갖고 있다.
- **멀티 프로세스**는 하나의 프로세스가 죽더라도 다른 프로세스에 영향을 주지 않아 **안정성**이 높지만, 멀티 스레드보다 **많은 메모리공간과 CPU 시간을 차지**하는 단점이 있다.
- 두 방법은 **동시에 여러 작업을 수행하는 점에서 동일**하지만, 각각의 장단점이 있으므로 적용하는 시스템에 따라 적합한 동작 방식을 선택하고 적용해야 한다.

### **멀티 프로세싱 vs 멀티 스레딩의 예시**

인터넷 익스플로러는 멀티 스레딩 기법으로 브라우저를 실행시켰다. 자원의 효율성을 높여주는 장점이 있지만 단점은

스레드에서 생긴 문제가 프로세스 전체에 영향을 미친다는 점이다.

[ 하나의 탭이 멈추는데 해당 브라우저 전체를 꺼야 했다. ]

반면 크롬의 경우 멀티 프로세싱 방식으로 브라우저를 운영한다.

즉 하나의 탭은 하나의 프로세스인 셈이다. 그래서 탭 하나에 문제가 생겨도 다른 탭에는 영향을 주지 않는다.

멀티코어 CPU가 대중화되면서 여러 개의 프로세스를 여러 개의 CPU에서 동시에 실행할 수 있는 환경이 되면서

멀티 프로세싱을 활용해도 크게 문제가 되지 않는 것이다. [ 대신 자원을 어마 무시하게 잡아먹는다. ]

### 멀티프로세스 대신 멀티 쓰레드를 사용하는 이유는?

**프로그램을 여러 개 키는 것보다 하나의 프로그램 안에서 여러 작업을 해결하는 것이 더 낫기 때문이다.**

✔️ **자원의 효율성 증대** 

멀티 프로세스로 실행되는 작업을 멀티 스레드로 실행할 경우, 공유 메모리를 두거나, 파일, 파이프 등등 프로세스 간의 통신을 위한 기술로 프로세스끼리 통신해야 한다. 

스레드는 프로세스 내의 메모리를 공유하기 때문에 독립적인 프로세스와 달리 스레드 간 데이터를 주고 받는 것이 간단해지고 시스템 자원 소모가 줄어들게 된다.

✔️ **처리 비용 감소 및 응답 시간 단축** 또한 프로세스 간의 통신(IPC)보다 스레드 간의 통신의 비용이 적으므로 작업들 간의 통신의 부담이 줄어든다.

스레드는 Stack 영역을 제외한 모든 메모리를 공유하기 때문에 프로세스 간의 전환 속도보다 스레드 간의 전환 속도가 빠르다. Context Switching시 스레드는 Stack 영역만 처리하기 때문이다.

### **그렇다면 무조건 멀티 스레드가 좋을까?**

- 스레드를 활용하면 자원의 효율성이 증가하기도 하지만, 스레드 간의 자원 공유는 전역 변수를 이용하므로 동기화 문제가 발생 할 수 있으므로 프로그래머의 주의가 필요하다.
